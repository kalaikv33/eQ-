/*
creator  : Kv
Date     : 19.12.2025
Time     : 11:12 PM
used cases : PWM communication in Timer
Submodel: STM32F103C8T6
model : cortex M-3(STM32)

 Configuring the PWM
 formula:
 f{timer}=APB1/{PSC+1}
 f{PWM}=f{timer}/(ARR+1)
 Duty Cycle={CCR}/{ARR+1} * 100% 
 ARR=Fosc/psc*fpwm
 
 
 */
 
 #include<stm32f10x.h>
 
 unsigned int delay(unsigned int ab){
	 while(ab--);
 }
 
 int main(){
 
 RCC->APB2ENR |= RCC_APB2ENR_IOPAEN|RCC_APB2ENR_TIM1EN|RCC_APB2ENR_AFIOEN;
 GPIOA->CRH &= ~(0XF << (4*0));
	 // TIM1/8_CHx x Output compare channel x Alternate function push-pull
	 //pin PA8 - Timer 1 channel 1
GPIOA->CRH |= (0XA << (4*0));
TIM1->ARR = 16-1; //frequency
TIM1->CCR1 = 8; //duty cycle 50%
TIM1->PSC =  10000-1;
	 TIM1->CR1 |= (1<<7)|(1<<0);
	 TIM1->CCMR2 |= (1<<3)|(6<<4); //EN - output compare mode & preload
	 TIM1->CCER |= (1<<0)|(1<<1); // Capture/Compare 1 output enable | Capture/Compare 1 output polarity
	 //TIM1->BDTR |= (1<<15); // MOE

	 while(1)
	 {
    for(unsigned int l=0;l<16;l++){
		TIM1->CCR1=l;
			delay(5);
		}
	 }
 }