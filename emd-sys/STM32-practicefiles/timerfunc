/*
creator  : Kv
Date     : 07.12.2025
Time     : 16:35 PM
used cases : Timer 
Submodel: STM32F103C8T6
model : cortex M-3(STM32)

 Configuring the general purpose timer
*/
#include<stm32f10x.h>

typedef unsigned int unit;

void delaytimer(unit k);

int main(){
	RCC->APB1ENR |= RCC_APB1ENR_TIM2EN; // tim2 pin Output compare channel x Alternate function push-pull
	RCC->APB2ENR |= RCC_APB2ENR_IOPAEN|RCC_APB2ENR_IOPBEN;
	TIM2->CNT=0;
	TIM2->PSC=10000-1;
	TIM2->ARR=7200-1;
	TIM2->CR1= (1<<0);
	//pin setting PA1 output
	GPIOA->CRL&=~(0XF<<(4*0));
	GPIOA->CRL|=(0X2<<(4*0));
	//pin setting PB3 input
	GPIOB->CRL&=~(0XF<<(4*3));
	GPIOB->CRL|=(0X4<<(4*3));
	 
	while(1){
		if(GPIOB->IDR&(1<<3))
			{
		GPIOA->ODR|=(1<<0); //mtr1
		delaytimer(5);
		GPIOA->BRR|=(1<<0);  //mtr0
		delaytimer(5);
	    }
 }
}


void delaytimer(unit k){
	unit sec=0;
	while(k>sec){	
		if(TIM2->SR&(1<<0))
			{
			sec++;
			TIM2->SR&=~(1<<0);

	    }
}}
