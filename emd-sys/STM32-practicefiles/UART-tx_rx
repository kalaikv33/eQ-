/*
creator  : Kv
Date     : 07.12.2025
Time     : 16:23 PM
used cases : UART communication in TX & RX
Submodel: STM32F103C8T6
model : cortex M-3(STM32)

 Configuring the UART communication in TX & RX
*/
#include <stm32f10x.h>
void uart_tx(char abc);
void uart_txstr(char *);
void uart_rx(int ab);

int main()
{
    RCC->APB2ENR |= RCC_APB2ENR_IOPAEN | RCC_APB2ENR_USART1EN | RCC_APB2ENR_AFIOEN;
    // pinconfg USARTx_TX|Full duplex|Alternate function push-pull
    // PA9-Tx
    GPIOA->CRH &= ~(0XF << (4 * 1));
    GPIOA->CRH |= (0XA << (4 * 1));
    // pinconfg USARTx_RX|Full duplex|Input floating / Input pull-up
    // PA10-Rx
    GPIOA->CRH &= ~(0XF << (4 * 2));
    GPIOA->CRH |= (0X4 << (4 * 2));
    while (1)
    {

        uart_txstr("kalai");
        for (volatile int i = 0; i < 1000000; i++)
            ;
    }
}

void uart_tx(char abc)
{
    USART1->CR1 |= (1 << 13) | (1 << 3);
    USART1->BRR = 0X341;
    while (1)
    {
        USART1->DR = abc;
        while (!(USART1->SR & 1 << 7))
            ;
    }
}

void uart_txstr(char *str)
{
    while (*str)
    {
        uart_tx(*str++);
    }
}

void uart_rx(int ab)
{
    USART1->CR1 |= (1 << 13) | (1 << 2);
    USART1->BRR |= 0X341;
    while (1)
    {
        while (!(USART1->SR & 1 << 5))
            ;
        ab = USART1->DR;
        USART1->SR &= ~(1 << 5);
    }
}